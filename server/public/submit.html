<!DOCTYPE html>
<html>
<head>
  <title>Share Your Experience - Honest UGC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Hide content until customizations are loaded */
    body {
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    body.loaded {
      opacity: 1;
    }
    
    * {
      box-sizing: border-box;
    }
    
    :root {
      --primary-color: #b89685;
      --secondary-color: #f8f6f3;
      --text-color: #4a5568;
      --accent-color: #d4a574;
      --heading-font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --body-font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    body {
      font-family: var(--body-font);
      line-height: 1.6;
      color: var(--text-color);
      margin: 0;
      padding: 0;
      background-color: var(--secondary-color);
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-family: var(--heading-font);
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
      color: white;
      padding: 60px 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: float 20s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(-30px, -30px) rotate(180deg); }
    }
    
    .header h1 {
      margin: 0 0 15px 0;
      font-size: 42px;
      font-weight: 700;
      letter-spacing: -1px;
      position: relative;
      z-index: 1;
      font-family: var(--heading-font);
    }
    
    .header p {
      margin: 0;
      font-size: 20px;
      opacity: 0.95;
      font-weight: 500;
      position: relative;
      z-index: 1;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .job-info {
      background: linear-gradient(135deg, #fdfcfb 0%, #fbf9f7 100%);
      padding: 30px;
      border-radius: 16px;
      margin-bottom: 40px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid #e8e5e3;
      position: relative;
      overflow: hidden;
    }
    
    .job-info::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
    }
    
    .job-info h2 {
      margin: 0 0 15px 0;
      font-size: 24px;
      font-weight: 600;
      color: #3a4152;
    }
    
    .job-info p {
      margin: 10px 0;
      color: #5a6575;
      line-height: 1.6;
    }
    
    .reward-badge {
      display: inline-block;
      padding: 8px 16px;
      background: linear-gradient(135deg, #e3f1df 0%, #d4edda 100%);
      color: #008060;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-top: 10px;
    }
    
    .form-container {
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid #e8e5e3;
    }
    
    .form-group {
      margin-bottom: 25px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #3a4152;
      font-size: 15px;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e8e5e3;
      border-radius: 12px;
      font-size: 16px;
      font-family: inherit;
      transition: all 0.3s ease;
      background: #fafaf9;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #b89685;
      background: white;
      box-shadow: 0 0 0 3px rgba(184, 150, 133, 0.1);
    }
    
    input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
    }
    
    .checkbox-label {
      display: flex;
      align-items: center;
      font-weight: 500;
      color: #5a6575;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .btn {
      padding: 16px 32px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
      transition: all 0.3s ease;
      letter-spacing: 0.3px;
      font-family: inherit;
      width: 100%;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
      color: white;
      box-shadow: 0 4px 14px rgba(184, 150, 133, 0.25);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(184, 150, 133, 0.35);
    }
    
    .btn-primary:disabled {
      background: #e8e5e3;
      color: #94a3b8;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .success {
      background: linear-gradient(135deg, #e3f1df 0%, #d4edda 100%);
      color: #155724;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      border: 1px solid #c3e6cb;
      font-weight: 500;
    }
    
    .error {
      background: linear-gradient(135deg, #fdf2f2 0%, #fed7d7 100%);
      color: #721c24;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      border: 1px solid #f5c6cb;
      font-weight: 500;
    }
    
    .file-upload {
      position: relative;
      display: inline-block;
      cursor: pointer;
      width: 100%;
    }
    
    .file-upload input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .file-upload-label {
      display: block;
      padding: 20px;
      background: linear-gradient(135deg, #fafaf9 0%, #f6f5f3 100%);
      border: 2px dashed var(--primary-color);
      border-radius: 12px;
      text-align: center;
      transition: all 0.3s ease;
      color: #5a6575;
      font-weight: 500;
    }
    
    .file-upload-label:hover {
      background: linear-gradient(135deg, #f6f5f3 0%, #f3f2f0 100%);
      border-color: var(--accent-color);
      transform: translateY(-1px);
    }
    
    .file-info {
      margin-top: 12px;
      font-size: 14px;
      color: #718096;
      font-weight: 500;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .browse-jobs {
      text-align: center;
      margin: 40px 0;
      padding: 30px;
      background: linear-gradient(135deg, #fafaf9 0%, #f6f5f3 100%);
      border-radius: 16px;
      border: 1px solid #e8e5e3;
    }
    
    /* Example Videos Section */
    .examples-section {
      max-width: 1200px;
      margin: -30px auto 0 auto;
      padding: 0 20px;
      position: relative;
      z-index: 10;
    }
    
    .video-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
    }
    
    .video-container {
      position: relative;
      aspect-ratio: 9/16;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.3s ease;
      border: 1px solid #e8e5e3;
      overflow: hidden;
    }
    
    .video-container:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }
    
    .video-placeholder {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    .play-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 2;
    }
    
    .play-button:hover {
      background: rgba(255, 255, 255, 1);
      transform: translate(-50%, -50%) scale(1.1);
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }
    
    .play-button::after {
      content: '';
      width: 0;
      height: 0;
      border-left: 15px solid var(--primary-color);
      border-top: 10px solid transparent;
      border-bottom: 10px solid transparent;
      margin-left: 3px;
    }
    
    .video-container.playing .play-button {
      opacity: 0;
      pointer-events: none;
    }
    
    .browse-jobs p {
      margin: 0 0 15px 0;
      color: #5a6575;
      font-weight: 500;
    }
    
    .browse-jobs a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 600;
      padding: 12px 24px;
      border: 2px solid var(--primary-color);
      border-radius: 25px;
      transition: all 0.3s ease;
      display: inline-block;
    }
    
    .browse-jobs a:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-1px);
    }
    
    @media (max-width: 768px) {
      .header h1 {
        font-size: 32px;
      }
      
      .header p {
        font-size: 18px;
      }
      
      .container {
        padding: 20px;
      }
      
      .form-container {
        padding: 25px;
      }
      
      .job-info {
        padding: 25px;
      }
      
      .video-row {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }
      
      @media (max-width: 640px) {
        .video-row {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1 id="pageHeading">Share Your Experience ✨</h1>
    <p id="pageSubheading">Get rewarded for your authentic content</p>
  </div>
  
  <div class="container">
    <div id="jobInfo" class="job-info" style="display:none;">
      <span id="jobType" class="job-type" style="display: inline-block; padding: 6px 16px; background: #e7f1f8; color: #5a7a8f; border-radius: 20px; font-size: 13px; font-weight: 600; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 0.5px;"></span>
      <h2 id="jobTitle"></h2>
      <p id="jobDescription"></p>
      <div id="jobRequirements" style="margin: 20px 0;"></div>
      <p><strong>Reward:</strong> <span class="reward-badge" id="jobReward"></span></p>
      <p id="jobDeadline" style="margin-top: 15px;"></p>
      <div id="jobInspiration" style="margin: 20px 0;"></div>
    </div>
    
    <div id="message"></div>
    
    <div class="form-container">
      <form id="ugcForm">
    <div class="form-group">
      <label for="customerEmail">Email Address*</label>
      <input type="email" id="customerEmail" name="customerEmail" required>
    </div>
    
    <div class="form-group" id="typeGroup">
      <label for="type">What would you like to share?*</label>
      <select id="type" name="type" required>
        <option value="photo">Photo (20% off)</option>
        <option value="video">Video (20% off)</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="content">Any additional comments about your submission?</label>
      <textarea id="content" name="content" rows="4" placeholder="Optional: Share any additional details about your submission..."></textarea>
    </div>
    
        <div class="form-group" id="mediaGroup" style="display:none;">
      <label id="mediaLabel">Upload Photo/Video</label>
      <div class="file-upload">
      <input type="file" id="media" name="media" accept="image/*,video/*">
        <label for="media" class="file-upload-label">
          <span id="fileLabel">Choose file or drag and drop here</span>
        </label>
      </div>
      <div id="fileInfo" class="file-info"></div>
    </div>
    
        
        <div class="form-group" id="paypalEmailGroup" style="display:none;">
          <label for="paypalEmail">Your PayPal Email (for cash rewards)*</label>
          <input type="email" id="paypalEmail" name="paypalEmail" placeholder="your-paypal-email@example.com">
          <small>We will use this email to send your cash reward via PayPal.</small>
        </div>
        
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" required>
            I agree to allow this business to use my content for marketing purposes
          </label>
        </div>
        
        <button type="submit" id="submitBtn" class="btn btn-primary">Submit & Get Reward</button>
      </form>
    </div>

    <div class="browse-jobs">
      <p>Want to reply to a different content request?</p>
      <a href="/jobs" id="browseJobsLink">Browse All Available UGC Jobs →</a>
    </div>
  </div>

  <script>
    // Load customizations
    async function loadCustomizations() {
      try {
        // Get shop from URL or default
        const urlParams = new URLSearchParams(window.location.search);
        const shop = urlParams.get('shop');
        
        const response = await fetch(`/api/public/customizations?shop=${shop}`);
        const customizations = await response.json();
        
        // Apply customizations
        if (customizations.primary_color) {
          document.documentElement.style.setProperty('--primary-color', customizations.primary_color);
        }
        if (customizations.secondary_color) {
          document.documentElement.style.setProperty('--secondary-color', customizations.secondary_color);
        }
        if (customizations.text_color) {
          document.documentElement.style.setProperty('--text-color', customizations.text_color);
        }
        if (customizations.accent_color) {
          document.documentElement.style.setProperty('--accent-color', customizations.accent_color);
        }
        
        // Apply fonts
        if (customizations.heading_font || customizations.body_font) {
          const fonts = new Set([customizations.heading_font, customizations.body_font].filter(Boolean));
          const fontLink = document.createElement('link');
          fontLink.href = `https://fonts.googleapis.com/css2?family=${Array.from(fonts).join('&family=')}&display=swap`;
          fontLink.rel = 'stylesheet';
          document.head.appendChild(fontLink);
          
          if (customizations.heading_font) {
            document.documentElement.style.setProperty('--heading-font', customizations.heading_font);
          }
          if (customizations.body_font) {
            document.documentElement.style.setProperty('--body-font', customizations.body_font);
          }
        }
        
        // Apply hero image
        if (customizations.hero_image_url) {
          const hero = document.querySelector('.header');
          if (hero) {
            hero.style.backgroundImage = `url('${customizations.hero_image_url}')`;
            hero.style.backgroundSize = 'cover';
            hero.style.backgroundPosition = 'center';
          }
        }
        
        // Apply logo
        if (customizations.logo_url) {
          const header = document.querySelector('.header');
          if (header) {
            const logo = document.createElement('div');
            logo.className = 'logo';
            
            // Set logo size and positioning based on customization
            let maxWidth, maxHeight, topPosition, headerPadding;
            switch (customizations.logo_size) {
              case 'small':
                maxWidth = '120px';
                maxHeight = '40px';
                topPosition = '20px';
                headerPadding = '60px 20px';
                break;
              case 'large':
                maxWidth = '300px';
                maxHeight = '90px';
                topPosition = '30px';
                headerPadding = '120px 20px';
                break;
              default: // medium
                maxWidth = '200px';
                maxHeight = '60px';
                topPosition = '25px';
                headerPadding = '80px 20px';
                break;
            }
            
            logo.style.cssText = `position: absolute; top: ${topPosition}; left: 50%; transform: translateX(-50%); z-index: 10;`;
            logo.innerHTML = `<img src="${customizations.logo_url}" alt="Logo" style="max-height: ${maxHeight}; max-width: ${maxWidth};">`;
            
            // Adjust header padding to accommodate logo
            header.style.padding = headerPadding;
            
            header.appendChild(logo);
          }
        }
        
        // Apply custom CSS
        if (customizations.custom_css) {
          const style = document.createElement('style');
          style.textContent = customizations.custom_css;
          document.head.appendChild(style);
        }
        
        // Apply custom headings
        if (customizations.submit_heading) {
          const headingEl = document.getElementById('pageHeading');
          if (headingEl) {
            headingEl.textContent = customizations.submit_heading;
          }
        }
        if (customizations.submit_subheading) {
          const subheadingEl = document.getElementById('pageSubheading');
          if (subheadingEl) {
            subheadingEl.textContent = customizations.submit_subheading;
          }
        }
        
        // Show the page after customizations are applied
        document.body.classList.add('loaded');
      } catch (error) {
        console.error('Error loading customizations:', error);
        // Show page even if customizations fail
        document.body.classList.add('loaded');
      }
    }
    
    // Load customizations immediately
    loadCustomizations();
    
    // Update browse jobs link with shop parameter
    const browseJobsLink = document.getElementById('browseJobsLink');
    if (browseJobsLink) {
      const urlParams = new URLSearchParams(window.location.search);
      const shop = urlParams.get('shop');
      if (shop) {
        browseJobsLink.href = `/jobs/${encodeURIComponent(shop)}`;
      }
    }

    const form = document.getElementById('ugcForm');
    const typeSelect = document.getElementById('type');
    const mediaGroup = document.getElementById('mediaGroup');
    const messageDiv = document.getElementById('message');
    const fileInput = document.getElementById('media');
    const fileLabel = document.getElementById('fileLabel');
    const fileInfo = document.getElementById('fileInfo');
    const submitBtn = document.getElementById('submitBtn');
    
    // Get URL params
    const urlParams = new URLSearchParams(window.location.search);
    const shop = urlParams.get('shop');
    const jobId = urlParams.get('jobId');
    
    // If job ID is provided, load job details
    if (jobId) {
      loadJobDetails(jobId, shop);
    }
    
    // Load job details
    async function loadJobDetails(id, shop) {
      try {
        const response = await fetch(`/api/public/jobs/${id}?shop=${encodeURIComponent(shop)}`);
        const data = await response.json();
        const job = data.job;
        
        // Display job info
        document.getElementById('jobInfo').style.display = 'block';
        
        // Set job type tag
        const jobTypeElement = document.getElementById('jobType');
        jobTypeElement.textContent = job.type === 'video' ? '🎬 Video' : '📸 Photo';
        jobTypeElement.style.background = job.type === 'video' ? '#e9e5f5' : '#f5e9f3';
        jobTypeElement.style.color = job.type === 'video' ? '#6f6a8b' : '#8b6f86';
        
        document.getElementById('jobTitle').textContent = job.title;
        document.getElementById('jobDescription').textContent = job.description;
        document.getElementById('jobReward').textContent = formatReward(job);
        
        // Display requirements if they exist
        const requirementsDiv = document.getElementById('jobRequirements');
        if (job.requirements && job.requirements.trim()) {
          const requirements = job.requirements.split('\n').filter(r => r.trim());
          if (requirements.length > 0) {
            requirementsDiv.innerHTML = `
              <h4 style="margin: 0 0 10px 0; color: #3a4152; font-size: 16px; font-weight: 600;">✨ Requirements:</h4>
              <ul style="margin: 0; padding-left: 20px; color: #5a6575;">
                ${requirements.map(req => `<li style="margin-bottom: 8px; line-height: 1.5;">${req}</li>`).join('')}
              </ul>
            `;
          } else {
            requirementsDiv.innerHTML = '';
          }
        } else {
          requirementsDiv.innerHTML = '';
        }
        
        // Display deadline if it exists
        const deadlineDiv = document.getElementById('jobDeadline');
        if (job.deadline) {
          const deadline = new Date(job.deadline);
          const daysLeft = Math.ceil((deadline - new Date()) / (1000 * 60 * 60 * 24));
          deadlineDiv.innerHTML = `
            <strong>⏰ Deadline:</strong> ${deadline.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })} 
            <span style="color: #c06866; font-weight: normal;">(${daysLeft} days left)</span>
          `;
        } else {
          deadlineDiv.innerHTML = '';
        }
        
        // Display inspiration content if it exists
        const inspirationDiv = document.getElementById('jobInspiration');
        if (job.example_content && job.example_content.trim()) {
          const content = job.example_content.trim();
          
          // Split content by newlines and filter out empty lines
          const contentLines = content.split('\n').filter(line => line.trim());
          
          // Separate video URLs and text content
          const videoUrls = contentLines.filter(line => isVideoUrl(line.trim()));
          const textContent = contentLines.filter(line => !isVideoUrl(line.trim()));
          
          let inspirationHTML = '';
          
          // Add text content if any
          if (textContent.length > 0) {
            inspirationHTML += `
              <h4 style="margin: 0 0 10px 0; color: #3a4152; font-size: 16px; font-weight: 600;">💡 Inspiration:</h4>
              <p style="color: #718096; line-height: 1.6; margin: 0 0 20px 0;">${textContent.join('<br>')}</p>
            `;
          }
          
          // Add video content if any
          if (videoUrls.length > 0) {
            const videoTitle = videoUrls.length === 1 ? '💡 Inspiration:' : '💡 Inspiration:';
            inspirationHTML += `<h4 style="margin: 0 0 15px 0; color: #3a4152; font-size: 16px; font-weight: 600;">${videoTitle}</h4>`;
            
            videoUrls.forEach((videoUrl, index) => {
              inspirationHTML += `
                <div style="text-align: center; margin-bottom: 15px;">
                  <a href="${videoUrl.trim()}" target="_blank" style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%); color: white; text-decoration: none; border-radius: 20px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(184, 150, 133, 0.25);">
                    🔗 Inspiration Photo/Video ${videoUrls.length > 1 ? index + 1 : ''}
                  </a>
                  <div style="margin-top: 8px; font-size: 12px; color: #718096;">
                    Opens in new tab
                  </div>
                </div>
              `;
            });
          }
          
          inspirationDiv.innerHTML = inspirationHTML;
        } else {
          inspirationDiv.innerHTML = '';
        }
        
        // Set the content type; hide the selector but keep it enabled so it submits
        document.getElementById('type').value = job.type;
        document.getElementById('type').disabled = false;
        document.getElementById('typeGroup').style.display = 'none';
        
        // Show media upload if needed
        if (job.type === 'photo' || job.type === 'video') {
          mediaGroup.style.display = 'block';
          fileInput.required = true;
          
          // Update the label based on job type
          const mediaLabel = document.getElementById('mediaLabel');
          mediaLabel.textContent = job.type === 'video' ? 'Upload Video' : 'Upload Photo';
        }
        
        // Toggle PayPal email field if cash reward
        const paypalGroup = document.getElementById('paypalEmailGroup');
        if (job && job.reward_type === 'cash') {
          paypalGroup.style.display = 'block';
          document.getElementById('paypalEmail').required = true;
        } else {
          paypalGroup.style.display = 'none';
          document.getElementById('paypalEmail').required = false;
        }
        
        // Add job requirements to content placeholder
        //if (job.requirements) {
        //  document.getElementById('content').placeholder = `Requirements:\n${job.requirements}\n\nYour description...`;
        //}
      } catch (error) {
        console.error('Error loading job details:', error);
      }
    }
    
    // Format reward
    function formatReward(job) {
      if (job.reward_type === 'percentage') {
        return job.reward_value + '% off';
      } else if (job.reward_type === 'fixed') {
        return '$' + job.reward_value + ' off';
      } else if (job.reward_type === 'giftcard') {
        return '$' + (job.reward_giftcard_amount || '') + ' gift card';
      } else if (job.reward_type === 'cash') {
        return '$' + (job.reward_cash_amount || job.reward_value || 0) + ' cash';
      } else {
        return 'Free ' + (job.reward_product || 'product');
      }
    }
    
    // Check if content is a video URL
    function isVideoUrl(content) {
      const trimmedContent = content.trim();
      const lowerContent = trimmedContent.toLowerCase();
      
      // Check if it looks like a URL (starts with http/https or www)
      const isUrl = /^https?:\/\//.test(trimmedContent) || /^www\./.test(trimmedContent);
      
      if (!isUrl) {
        return false;
      }
      
      // Check for video file extensions
      const videoExtensions = ['.mp4', '.mov', '.avi', '.wmv', '.flv', '.webm', '.mkv'];
      if (videoExtensions.some(ext => lowerContent.includes(ext))) {
        return true;
      }
      
      // Check for video hosting platforms
      const videoPlatforms = [
        'youtube.com',
        'youtu.be',
        'vimeo.com',
        'dailymotion.com',
        'tiktok.com',
        'instagram.com',
        'facebook.com',
        'twitter.com',
        'x.com',
        'twitch.tv',
        'streamable.com',
        'wistia.com',
        'loom.com',
        's3.amazonaws.com',
        'cloudfront.net',
        'drive.google.com'
      ];
      
      if (videoPlatforms.some(platform => lowerContent.includes(platform))) {
        return true;
      }
      
      return false;
    }
    
    // Play inspiration video
    function playInspirationVideo(video) {
      if (video.paused) {
        video.play();
      } else {
        video.pause();
      }
    }
    
    // Handle video loading errors
    function handleVideoError(video) {
      console.error('Video failed to load:', video.src);
      const container = video.parentElement;
      container.innerHTML = `
        <div style="padding: 20px; text-align: center; background: #f8f9fa; border-radius: 8px; border: 1px solid #e8e5e3;">
          <p style="margin: 0 0 10px 0; color: #718096;">Video couldn't be loaded</p>
          <a href="${video.src}" target="_blank" style="color: #b89685; text-decoration: none; font-weight: 600;">Open video in new tab →</a>
        </div>
      `;
    }
    
    // Show/hide media upload based on type
    typeSelect.addEventListener('change', (e) => {
      if (e.target.value === 'photo' || e.target.value === 'video') {
        mediaGroup.style.display = 'block';
        fileInput.required = true;
      } else {
        mediaGroup.style.display = 'none';
        fileInput.required = false;
        fileInput.value = '';
        fileLabel.textContent = 'Choose file or drag and drop here';
        fileInfo.textContent = '';
      }
    });
    
    // Handle file selection
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        fileLabel.textContent = file.name;
        const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
        fileInfo.textContent = `File size: ${sizeMB} MB`;
        
        // Validate file size (50MB limit)
        if (file.size > 50 * 1024 * 1024) {
          fileInfo.style.color = 'red';
          fileInfo.textContent += ' (File too large! Maximum size is 50MB)';
          submitBtn.disabled = true;
        } else {
          fileInfo.style.color = '#666';
          submitBtn.disabled = false;
        }
      }
    });
    
    // Handle form submission (replace the existing form submission handler in submit.html)
    form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Show loading state
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="loading"></span> Submitting...';
    
    // Clear any previous messages
    messageDiv.innerHTML = '';
    
    // Create FormData object
    const formData = new FormData(form);
    
    // CRITICAL: Get shop parameter from URL
    const urlParams = new URLSearchParams(window.location.search);
    const shop = urlParams.get('shop');
    
    // Add shop parameter - try multiple field names to ensure it's caught
    if (shop) {
      formData.append('shop', shop);
      formData.append('shopDomain', shop); // Also add as shopDomain for redundancy
      console.log('Submitting with shop:', shop); // Debug log
    } else {
      console.warn('No shop parameter found in URL!');
    }
    
    // Add job ID if present
    if (jobId) {
      formData.append('jobId', jobId);
      console.log('Submitting with jobId:', jobId); // Debug log
    }
    
    // Log all form data for debugging
    console.log('Form data being sent:');
    for (let [key, value] of formData.entries()) {
      if (value instanceof File) {
        console.log(`${key}: [File: ${value.name}]`);
      } else {
        console.log(`${key}: ${value}`);
      }
    }
    
    try {
      const response = await fetch('/api/public/submit', {
        method: 'POST',
        body: formData
      });
      
      const result = await response.json();
      console.log('Submission response:', result); // Debug log
      
      if (result.success) {
        // Include submission number if available
        const submissionNumber = result.submissionNumber ? `#${result.submissionNumber}` : '';
        
        messageDiv.innerHTML = `
          <div class="success">
            <strong>Thank you! Your submission ${submissionNumber} has been received.</strong><br>
            We'll review your submission and get back to you soon.
          </div>
        `;
        
        form.reset();
        fileLabel.textContent = 'Choose file or drag and drop here';
        fileInfo.textContent = '';
        mediaGroup.style.display = 'none';
        
        // Hide form container after successful submission for job
        if (jobId) {
          document.querySelector('.form-container').style.display = 'none';
        }
        
        // Scroll to success message
        messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } else {
        // Handle different types of errors
        if (result.error === 'EMAIL_NOT_CONFIGURED') {
          // Show special message for email configuration error
          messageDiv.innerHTML = `
            <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
              <h3 style="margin: 0 0 10px 0; color: #856404; font-size: 18px; display: flex; align-items: center;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                  <line x1="12" y1="9" x2="12" y2="13"></line>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                Store Setup Not Complete
              </h3>
              <p style="margin: 10px 0; font-size: 16px;">
                ${result.userMessage || 'We apologize, but this store hasn\'t finished setting up their submission system yet.'}
              </p>
              <div style="background-color: #fef3c7; padding: 15px; border-radius: 6px; margin-top: 15px;">
                <p style="margin: 0 0 10px 0; font-size: 14px; color: #92400e; font-weight: 600;">
                  What you can do:
                </p>
                <ul style="margin: 0; padding-left: 20px; color: #92400e; font-size: 14px;">
                  <li>Contact the store directly through their website</li>
                  <li>Try again later - they may complete setup soon</li>
                  <li>Check if there's another way to submit content on their main site</li>
                </ul>
              </div>
            </div>
          `;
        } else {
          // Show generic error message
          messageDiv.innerHTML = `<div class="error">${result.message || 'There was an error submitting your content. Please try again.'}</div>`;
        }
        
        // Scroll to error message
        messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    } catch (error) {
      console.error('Submission error:', error);
      messageDiv.innerHTML = '<div class="error">Network error. Please check your connection and try again.</div>';
      messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'Submit & Get Reward';
    }
  });

  // Also add this validation at the beginning of your script (after line 506 where you get URL params):
  // Validate that shop parameter exists
  document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const shop = urlParams.get('shop');
    
    if (!shop) {
      console.error('WARNING: No shop parameter in URL. Submissions may fail.');
      // Optionally show a warning to the user
      const messageDiv = document.getElementById('message');
      if (messageDiv) {
        messageDiv.innerHTML = `
          <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <strong>⚠️ Configuration Issue:</strong> This submission form may not be properly configured. 
            If you experience issues submitting, please contact the store directly.
          </div>
        `;
      }
    } else {
      console.log('Shop parameter found:', shop);
    }
  });
    
    // Drag and drop functionality
    const fileUploadLabel = document.querySelector('.file-upload-label');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      fileUploadLabel.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
      fileUploadLabel.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
      fileUploadLabel.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight(e) {
      fileUploadLabel.style.backgroundColor = '#e9ecef';
      fileUploadLabel.style.borderColor = '#6c757d';
    }
    
    function unhighlight(e) {
      fileUploadLabel.style.backgroundColor = '#f8f9fa';
      fileUploadLabel.style.borderColor = '#dee2e6';
    }
    
    // Handle dropped files
    fileUploadLabel.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      
      if (files.length > 0) {
        fileInput.files = files;
        const event = new Event('change', { bubbles: true });
        fileInput.dispatchEvent(event);
      }
    }
  </script>
</body>
</html>