<!DOCTYPE html>
<html>
<head>
  <title>Share Your Experience - UGC Rewards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: #4a5568;
      margin: 0;
      padding: 0;
      background-color: #fafaf9;
    }
    
    .header {
      background: linear-gradient(135deg, #b89685 0%, #d4a574 100%);
      color: white;
      padding: 60px 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: float 20s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(-30px, -30px) rotate(180deg); }
    }
    
    .header h1 {
      margin: 0 0 15px 0;
      font-size: 42px;
      font-weight: 700;
      letter-spacing: -1px;
      position: relative;
      z-index: 1;
    }
    
    .header p {
      margin: 0;
      font-size: 20px;
      opacity: 0.95;
      font-weight: 500;
      position: relative;
      z-index: 1;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .job-info {
      background: linear-gradient(135deg, #fdfcfb 0%, #fbf9f7 100%);
      padding: 30px;
      border-radius: 16px;
      margin-bottom: 40px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid #e8e5e3;
      position: relative;
      overflow: hidden;
    }
    
    .job-info::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #b89685 0%, #d4a574 100%);
    }
    
    .job-info h2 {
      margin: 0 0 15px 0;
      font-size: 24px;
      font-weight: 600;
      color: #3a4152;
    }
    
    .job-info p {
      margin: 10px 0;
      color: #5a6575;
      line-height: 1.6;
    }
    
    .reward-badge {
      display: inline-block;
      padding: 8px 16px;
      background: linear-gradient(135deg, #e3f1df 0%, #d4edda 100%);
      color: #008060;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-top: 10px;
    }
    
    .form-container {
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid #e8e5e3;
    }
    
    .form-group {
      margin-bottom: 25px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #3a4152;
      font-size: 15px;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e8e5e3;
      border-radius: 12px;
      font-size: 16px;
      font-family: inherit;
      transition: all 0.3s ease;
      background: #fafaf9;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #b89685;
      background: white;
      box-shadow: 0 0 0 3px rgba(184, 150, 133, 0.1);
    }
    
    input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
    }
    
    .checkbox-label {
      display: flex;
      align-items: center;
      font-weight: 500;
      color: #5a6575;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .btn {
      padding: 16px 32px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
      transition: all 0.3s ease;
      letter-spacing: 0.3px;
      font-family: inherit;
      width: 100%;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #b89685 0%, #d4a574 100%);
      color: white;
      box-shadow: 0 4px 14px rgba(184, 150, 133, 0.25);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(184, 150, 133, 0.35);
    }
    
    .btn-primary:disabled {
      background: #e8e5e3;
      color: #94a3b8;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .success {
      background: linear-gradient(135deg, #e3f1df 0%, #d4edda 100%);
      color: #155724;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      border: 1px solid #c3e6cb;
      font-weight: 500;
    }
    
    .error {
      background: linear-gradient(135deg, #fdf2f2 0%, #fed7d7 100%);
      color: #721c24;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      border: 1px solid #f5c6cb;
      font-weight: 500;
    }
    
    .file-upload {
      position: relative;
      display: inline-block;
      cursor: pointer;
      width: 100%;
    }
    
    .file-upload input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .file-upload-label {
      display: block;
      padding: 20px;
      background: linear-gradient(135deg, #fafaf9 0%, #f6f5f3 100%);
      border: 2px dashed #b89685;
      border-radius: 12px;
      text-align: center;
      transition: all 0.3s ease;
      color: #5a6575;
      font-weight: 500;
    }
    
    .file-upload-label:hover {
      background: linear-gradient(135deg, #f6f5f3 0%, #f3f2f0 100%);
      border-color: #d4a574;
      transform: translateY(-1px);
    }
    
    .file-info {
      margin-top: 12px;
      font-size: 14px;
      color: #718096;
      font-weight: 500;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .browse-jobs {
      text-align: center;
      margin: 40px 0;
      padding: 30px;
      background: linear-gradient(135deg, #fafaf9 0%, #f6f5f3 100%);
      border-radius: 16px;
      border: 1px solid #e8e5e3;
    }
    
    .browse-jobs p {
      margin: 0 0 15px 0;
      color: #5a6575;
      font-weight: 500;
    }
    
    .browse-jobs a {
      color: #b89685;
      text-decoration: none;
      font-weight: 600;
      padding: 12px 24px;
      border: 2px solid #b89685;
      border-radius: 25px;
      transition: all 0.3s ease;
      display: inline-block;
    }
    
    .browse-jobs a:hover {
      background: #b89685;
      color: white;
      transform: translateY(-1px);
    }
    
    @media (max-width: 768px) {
      .header h1 {
        font-size: 32px;
      }
      
      .header p {
        font-size: 18px;
      }
      
      .container {
        padding: 20px;
      }
      
      .form-container {
        padding: 25px;
      }
      
      .job-info {
        padding: 25px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Share Your Experience ✨</h1>
    <p>Get rewarded for your authentic content</p>
  </div>
  
  <div class="container">
    <div id="jobInfo" class="job-info" style="display:none;">
      <span id="jobType" class="job-type" style="display: inline-block; padding: 6px 16px; background: #e7f1f8; color: #5a7a8f; border-radius: 20px; font-size: 13px; font-weight: 600; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 0.5px;"></span>
      <h2 id="jobTitle"></h2>
      <p id="jobDescription"></p>
      <div id="jobRequirements" style="margin: 20px 0;"></div>
      <p><strong>Reward:</strong> <span class="reward-badge" id="jobReward"></span></p>
      <p id="jobDeadline" style="margin-top: 15px;"></p>
    </div>
    
    <div id="message"></div>
    
    <div class="form-container">
      <form id="ugcForm">
    <div class="form-group">
      <label for="email">Email Address*</label>
      <input type="email" id="email" name="email" required>
    </div>
    
    <div class="form-group" id="typeGroup">
      <label for="type">What would you like to share?*</label>
      <select id="type" name="type" required>
        <option value="photo">Photo (20% off)</option>
        <option value="video">Video (20% off)</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="content">Any additional comments about your submission?</label>
      <textarea id="content" name="content" rows="4" required></textarea>
    </div>
    
        <div class="form-group" id="mediaGroup" style="display:none;">
      <label id="mediaLabel">Upload Photo/Video</label>
      <div class="file-upload">
      <input type="file" id="media" name="media" accept="image/*,video/*">
        <label for="media" class="file-upload-label">
          <span id="fileLabel">Choose file or drag and drop here</span>
        </label>
      </div>
      <div id="fileInfo" class="file-info"></div>
    </div>
    
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" required>
            I agree to allow this business to use my content for marketing purposes
          </label>
        </div>
        
        <button type="submit" id="submitBtn" class="btn btn-primary">Submit & Get Reward</button>
      </form>
    </div>

    <div class="browse-jobs">
      <p>Want to reply to a different content request?</p>
      <a href="/jobs">Browse All Available UGC Jobs →</a>
    </div>
  </div>

  <script>
    const form = document.getElementById('ugcForm');
    const typeSelect = document.getElementById('type');
    const mediaGroup = document.getElementById('mediaGroup');
    const messageDiv = document.getElementById('message');
    const fileInput = document.getElementById('media');
    const fileLabel = document.getElementById('fileLabel');
    const fileInfo = document.getElementById('fileInfo');
    const submitBtn = document.getElementById('submitBtn');
    
    // Get URL params
    const urlParams = new URLSearchParams(window.location.search);
    const shop = urlParams.get('shop');
    const jobId = urlParams.get('jobId');
    
    // If job ID is provided, load job details
    if (jobId) {
      loadJobDetails(jobId);
    }
    
    // Load job details
    async function loadJobDetails(id) {
      try {
        const response = await fetch(`/api/public/jobs/${id}`);
        const data = await response.json();
        const job = data.job;
        
        // Display job info
        document.getElementById('jobInfo').style.display = 'block';
        
        // Set job type tag
        const jobTypeElement = document.getElementById('jobType');
        jobTypeElement.textContent = job.type === 'video' ? '🎬 Video' : '📸 Photo';
        jobTypeElement.style.background = job.type === 'video' ? '#e9e5f5' : '#f5e9f3';
        jobTypeElement.style.color = job.type === 'video' ? '#6f6a8b' : '#8b6f86';
        
        document.getElementById('jobTitle').textContent = job.title;
        document.getElementById('jobDescription').textContent = job.description;
        document.getElementById('jobReward').textContent = formatReward(job);
        
        // Display requirements if they exist
        const requirementsDiv = document.getElementById('jobRequirements');
        if (job.requirements && job.requirements.trim()) {
          const requirements = job.requirements.split('\n').filter(r => r.trim());
          if (requirements.length > 0) {
            requirementsDiv.innerHTML = `
              <h4 style="margin: 0 0 10px 0; color: #3a4152; font-size: 16px; font-weight: 600;">✨ Requirements:</h4>
              <ul style="margin: 0; padding-left: 20px; color: #5a6575;">
                ${requirements.map(req => `<li style="margin-bottom: 8px; line-height: 1.5;">${req}</li>`).join('')}
              </ul>
            `;
          } else {
            requirementsDiv.innerHTML = '';
          }
        } else {
          requirementsDiv.innerHTML = '';
        }
        
        // Display deadline if it exists
        const deadlineDiv = document.getElementById('jobDeadline');
        if (job.deadline) {
          const deadline = new Date(job.deadline);
          const daysLeft = Math.ceil((deadline - new Date()) / (1000 * 60 * 60 * 24));
          deadlineDiv.innerHTML = `
            <strong>⏰ Deadline:</strong> ${deadline.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })} 
            <span style="color: #c06866; font-weight: normal;">(${daysLeft} days left)</span>
          `;
        } else {
          deadlineDiv.innerHTML = '';
        }
        
        // Set the content type and lock it
        document.getElementById('type').value = job.type;
        document.getElementById('type').disabled = true;
        document.getElementById('typeGroup').style.display = 'none';
        
        // Show media upload if needed
        if (job.type === 'photo' || job.type === 'video') {
          mediaGroup.style.display = 'block';
          fileInput.required = true;
          
          // Update the label based on job type
          const mediaLabel = document.getElementById('mediaLabel');
          mediaLabel.textContent = job.type === 'video' ? 'Upload Video' : 'Upload Photo';
        }
        
        // Add job requirements to content placeholder
        //if (job.requirements) {
        //  document.getElementById('content').placeholder = `Requirements:\n${job.requirements}\n\nYour description...`;
        //}
      } catch (error) {
        console.error('Error loading job details:', error);
      }
    }
    
    // Format reward
    function formatReward(job) {
      if (job.reward_type === 'percentage') {
        return job.reward_value + '% off';
      } else if (job.reward_type === 'fixed') {
        return '$' + job.reward_value + ' off';
      } else {
        return 'Free ' + (job.reward_product || 'product');
      }
    }
    
    // Show/hide media upload based on type
    typeSelect.addEventListener('change', (e) => {
      if (e.target.value === 'photo' || e.target.value === 'video') {
        mediaGroup.style.display = 'block';
        fileInput.required = true;
      } else {
        mediaGroup.style.display = 'none';
        fileInput.required = false;
        fileInput.value = '';
        fileLabel.textContent = 'Choose file or drag and drop here';
        fileInfo.textContent = '';
      }
    });
    
    // Handle file selection
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        fileLabel.textContent = file.name;
        const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
        fileInfo.textContent = `File size: ${sizeMB} MB`;
        
        // Validate file size (50MB limit)
        if (file.size > 50 * 1024 * 1024) {
          fileInfo.style.color = 'red';
          fileInfo.textContent += ' (File too large! Maximum size is 50MB)';
          submitBtn.disabled = true;
        } else {
          fileInfo.style.color = '#666';
          submitBtn.disabled = false;
        }
      }
    });
    
    // Handle form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Show loading state
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="loading"></span> Submitting...';
      
      // Create FormData object
      const formData = new FormData();
      formData.append('customerEmail', document.getElementById('email').value);
      formData.append('type', document.getElementById('type').value);
      formData.append('content', document.getElementById('content').value);
      
      // Add job ID if present
      if (jobId) {
        formData.append('jobId', jobId);
      }
      
      // Add file if present
      if (fileInput.files[0]) {
        formData.append('media', fileInput.files[0]);
      }
      
      try {
        const response = await fetch('/api/public/submit', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<div class="success">Thank you! Your submission has been received. You\'ll receive your discount code via email within 24 hours.</div>';
          form.reset();
          fileLabel.textContent = 'Choose file or drag and drop here';
          fileInfo.textContent = '';
          mediaGroup.style.display = 'none';
          
          // Hide form after successful submission for job
          if (jobId) {
            form.style.display = 'none';
          }
        } else {
          messageDiv.innerHTML = '<div class="error">There was an error submitting your content. Please try again.</div>';
        }
      } catch (error) {
        messageDiv.innerHTML = '<div class="error">There was an error submitting your content. Please try again.</div>';
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'Submit & Get Reward';
      }
    });
    
    // Drag and drop functionality
    const fileUploadLabel = document.querySelector('.file-upload-label');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      fileUploadLabel.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
      fileUploadLabel.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
      fileUploadLabel.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight(e) {
      fileUploadLabel.style.backgroundColor = '#e9ecef';
      fileUploadLabel.style.borderColor = '#6c757d';
    }
    
    function unhighlight(e) {
      fileUploadLabel.style.backgroundColor = '#f8f9fa';
      fileUploadLabel.style.borderColor = '#dee2e6';
    }
    
    // Handle dropped files
    fileUploadLabel.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      
      if (files.length > 0) {
        fileInput.files = files;
        const event = new Event('change', { bubbles: true });
        fileInput.dispatchEvent(event);
      }
    }
  </script>
</body>
</html>