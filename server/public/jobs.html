<!DOCTYPE html>
<html>
<head>
  <title>Browse UGC Jobs - Get Rewarded for Your Content</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Hide content until customizations are loaded */
    body {
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    body.loaded {
      opacity: 1;
    }
    
    * {
      box-sizing: border-box;
    }
    
    :root {
      --primary-color: #b89685;
      --secondary-color: #f8f6f3;
      --text-color: #4a5568;
      --accent-color: #d4a574;
      --heading-font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --body-font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    body {
      font-family: var(--body-font);
      line-height: 1.6;
      color: var(--text-color);
      margin: 0;
      padding: 0;
      background-color: var(--secondary-color);
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-family: var(--heading-font);
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
      color: white;
      padding: 60px 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: float 15s ease-in-out infinite;
    }
    

    
    /* Example Videos Section */
    .examples-section {
      max-width: 1200px;
      margin: -30px auto 0 auto;
      padding: 0 20px;
      position: relative;
      z-index: 10;
    }
    
    .video-row {
      display: grid;
      gap: 20px;
      justify-content: center;
      margin: 0 auto;
    }
    
    .video-row.single {
      grid-template-columns: 1fr;
      max-width: 300px;
    }
    
    .video-row.two {
      grid-template-columns: repeat(2, 1fr);
      max-width: 600px;
    }
    
    .video-row.three {
      grid-template-columns: repeat(3, 1fr);
      max-width: 900px;
    }
    
    .video-row.four {
      grid-template-columns: repeat(4, 1fr);
      max-width: 1200px;
    }
    
    .video-container {
      position: relative;
      aspect-ratio: 9/16;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.3s ease;
      border: 1px solid #e8e5e3;
      overflow: hidden;
    }
    
    .video-container:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }
    
    .video-placeholder {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    .play-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 2;
    }
    
    .play-button:hover {
      background: rgba(255, 255, 255, 1);
      transform: translate(-50%, -50%) scale(1.1);
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }
    
    .play-button::after {
      content: '';
      width: 0;
      height: 0;
      border-left: 15px solid var(--primary-color);
      border-top: 10px solid transparent;
      border-bottom: 10px solid transparent;
      margin-left: 3px;
    }
    
    .video-container.playing .play-button {
      opacity: 0;
      pointer-events: none;
    }
    
    @keyframes float {
      0% { transform: translate(0, 0) rotate(0deg) scale(1); }
      25% { transform: translate(-20px, -15px) rotate(90deg) scale(1.1); }
      50% { transform: translate(-30px, -30px) rotate(180deg) scale(0.9); }
      75% { transform: translate(-15px, -20px) rotate(270deg) scale(1.05); }
      100% { transform: translate(0, 0) rotate(360deg) scale(1); }
    }
    

    
    .header h1 {
      margin: 0 0 15px 0;
      font-size: 42px;
      font-weight: 700;
      letter-spacing: -1px;
      position: relative;
      z-index: 1;
      font-family: var(--heading-font);
    }
    
    .header p {
      margin: 0;
      font-size: 20px;
      opacity: 0.95;
      font-weight: 500;
      position: relative;
      z-index: 1;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .filters {
      background: white;
      padding: 25px;
      border-radius: 16px;
      margin-bottom: 40px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid #e8e5e3;
    }
    
    .filters h3 {
      margin: 0 0 20px 0;
      font-size: 18px;
      font-weight: 600;
      color: #3a4152;
    }
    
    .filter-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .filter-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .filter-select {
      padding: 8px 16px;
      border: 2px solid #e8e5e3;
      border-radius: 20px;
      background: white;
      font-size: 14px;
      font-weight: 500;
      color: #5a6575;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .filter-select:focus {
      outline: none;
      border-color: #b89685;
      box-shadow: 0 0 0 3px rgba(184, 150, 133, 0.1);
    }
    
    .filter-btn {
      padding: 10px 24px;
      border: 2px solid #e8e5e3;
      background: white;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 15px;
      font-weight: 500;
      color: #718096;
    }
    
    .filter-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
      transform: translateY(-1px);
    }
    
    .filter-btn.active {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
      color: white;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(184, 150, 133, 0.2);
    }
    
    .jobs-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 25px;
    }
    
    .job-card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      transition: all 0.3s ease;
      cursor: pointer;
      border: 1px solid #e8e5e3;
      position: relative;
      overflow: hidden;
    }
    
    .job-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }
    
    .job-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.08);
    }
    
    .job-card:hover::before {
      transform: scaleX(1);
    }
    
    .job-type {
      display: inline-block;
      padding: 6px 16px;
      background: #e7f1f8;
      color: #5a7a8f;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 15px;
      letter-spacing: 0.5px;
    }
    
    .job-type.photo {
      background: #f5e9f3;
      color: #8b6f86;
    }
    
    .job-type.video {
      background: #e9e5f5;
      color: #6f6a8b;
    }
    
    .job-title {
      font-size: 22px;
      font-weight: 600;
      margin: 0 0 12px 0;
      color: #2d3748;
      line-height: 1.3;
    }
    
    .job-description {
      color: #718096;
      margin-bottom: 20px;
      font-size: 15px;
      line-height: 1.6;
    }
    
    .job-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 25px;
      padding-top: 25px;
      border-top: 1px solid #f3f2f1;
    }
    
    .reward {
      display: inline-flex;
      align-items: center;
      gap: 4px;           /* space between label and pill */
      max-width: 220px;   /* adjust as needed */
      /*white-space: nowrap;*/
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .spots-left {
      font-size: 10px;
      color: #718096;
      background: #f8f7f6;
      padding: 6px 14px;
      border-radius: 20px;
      font-weight: 500;
    }
    
    .spots-left.low {
      background: #fdf2f2;
      color: #c06866;
    }
    
    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: #718096;
    }
    
    .empty-state h3 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #3a4152;
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      overflow-y: auto;
      backdrop-filter: blur(4px);
    }
    
    .modal-content {
      background: white;
      margin: 40px auto;
      padding: 0;
      border-radius: 20px;
      width: 90%;
      max-width: 700px;
      position: relative;
      animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #f3f2f1;
      background: linear-gradient(135deg, #fdfcfb 0%, #fbf9f7 100%);
      border-radius: 20px 20px 0 0;
    }
    
    .modal-body {
      padding: 20px;
      padding-top: 0px;
    }
    
    .close {
      position: absolute;
      top: 25px;
      right: 25px;
      font-size: 32px;
      font-weight: 300;
      cursor: pointer;
      color: #94a3b8;
      background: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .close:hover {
      background: #f8f7f6;
      color: #475569;
      transform: rotate(90deg);
    }
    
    .requirements {
      background: linear-gradient(135deg, #faf9f8 0%, #f6f5f3 100%);
      padding: 25px;
      border-radius: 12px;
      margin: 25px 0;
      border: 1px solid #e8e5e3;
    }
    
    .requirements h4 {
      margin: 0 0 15px 0;
      font-size: 17px;
      font-weight: 600;
      color: #3a4152;
    }
    
    .requirements ul {
      margin: 0;
      padding-left: 20px;
      color: #5a6575;
    }
    
    .requirements li {
      margin-bottom: 10px;
      line-height: 1.5;
    }
    
    .btn {
      padding: 14px 32px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
      transition: all 0.3s ease;
      letter-spacing: 0.3px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
      color: white;
      box-shadow: 0 4px 14px rgba(184, 150, 133, 0.25);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(184, 150, 133, 0.35);
    }
    
    .deadline {
      font-size: 16px;
      margin-top: 10px;
      font-weight: 500;
    }
    
    .modal-meta-item {
      margin: 15px 0;
      font-size: 16px;
      color: #5a6575;
    }
    
    .modal-meta-item strong {
      color: #3a4152;
      font-weight: 600;
    }
    
    .tag {
      display: inline-block;
      padding: 4px 12px;
      background: #fef9e7;
      color: #b89657;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }

    .reward-label {
      font-weight: 600;
      color: #616161;
      margin-right: 4px;
    }
    .reward-value {
      color: #008060;
      font-weight: 500;
    }
    .reward-pill {
      background: #e3f1df;
      color: #008060;
      border-radius: 12px;
      padding: 2px 10px;
      margin-left: 6px;
      font-weight: 600;
      display: inline-block;
    }
    
    @media (max-width: 768px) {
      .header h1 {
        font-size: 32px;
      }
      
      .header p {
        font-size: 18px;
      }
      
      .jobs-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
      }
      
      .video-row {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }
      
      @media (max-width: 640px) {
        .jobs-grid {
          grid-template-columns: 1fr;
        }
        
        .video-row {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }
      }
      
      .job-card {
        padding: 25px;
      }
      
      .modal-content {
        margin: 20px auto;
        width: 95%;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1 id="pageHeading">Create Content, Get Rewarded ✨</h1>
    <p id="pageSubheading">Share your authentic experiences with brands you love</p>
  </div>

  <!-- Example Videos Section -->
  <div class="examples-section" id="examplesSection" style="display: none;">
    <div class="video-row" id="videoRow">
      <!-- Videos will be dynamically loaded here -->
    </div>
  </div>


  <div class="container">
    <div class="filters">
      <h3>What type of content do you love creating?</h3>
      <div class="filter-row">
        <div class="filter-group">
          <button class="filter-btn active" onclick="filterJobs('all')">All Jobs</button>
          <button class="filter-btn" onclick="filterJobs('video')">Video Content</button>
          <button class="filter-btn" onclick="filterJobs('photo')">Photo Content</button>
        </div>
        <div class="filter-group">
          <select class="filter-select" id="deadlineFilter" onchange="applyFilters()">
            <option value="all">Any Deadline</option>
            <option value="7">Within 7 days</option>
            <option value="14">Within 14 days</option>
            <option value="30">Within 30 days</option>
          </select>
          <select class="filter-select" id="rewardFilter" onchange="applyFilters()">
            <option value="all">Any Reward</option>
            <option value="percentage">Percentage Off</option>
            <option value="fixed">Fixed Amount Off</option>
            <option value="product">Free Product</option>
            <option value="giftcard">Gift Card</option>
          </select>
        </div>
      </div>
    </div>

    <div id="jobsGrid" class="jobs-grid">
      <div class="empty-state">
        <p>Loading amazing opportunities...</p>
      </div>
    </div>
  </div>

  <!-- Job Details Modal -->
  <div id="jobModal" class="modal">
    <div class="modal-content">
      <button class="close" onclick="closeModal()">&times;</button>
      <div class="modal-header">
        <span id="modalJobType" class="job-type"></span>
        <h2 id="modalJobTitle" class="job-title"></h2>
        <p id="modalJobDescription" class="job-description"></p>
      </div>
      <div class="modal-body">
        <div id="modalRequirements" class="requirements"></div>
        <div id="modalJobMeta" style="margin: 25px 0;">
          <p class="modal-meta-item"><strong>Your Reward:</strong> <span id="modalReward" class="reward"></span></p>
          <p class="modal-meta-item"><strong>Spots available:</strong> <span id="modalSpots"></span></p>
          <p id="modalDeadline" class="deadline"></p>
        </div>
        <div id="modalExample" style="margin: 25px 0;"></div>
        <div style="text-align: center; margin-top: 35px;">
          <button id="submitBtn" class="btn btn-primary" onclick="submitForJob()">I Want to Create This!</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Check if we have a valid shop in the URL before doing anything
    const urlPathParts = window.location.pathname.split('/');
    if (!(urlPathParts.length > 2 && urlPathParts[1] === 'jobs' && urlPathParts[2] && urlPathParts[2].trim() !== '')) {
      // If no valid shop in URL, redirect immediately
      window.location.href = '/';
    }
    
    // Load customizations
    async function loadCustomizations() {
      try {
        // Get shop from URL path or fallback to query params for backward compatibility
        let shop = null; // no default fallback
        
        // First try to get shop from URL path
        const pathParts = window.location.pathname.split('/');
        if (pathParts.length > 2 && pathParts[1] === 'jobs' && pathParts[2] && pathParts[2].trim() !== '') {
          shop = decodeURIComponent(pathParts[2]);
        } else {
          // Fallback to query params for backward compatibility
          const urlParams = new URLSearchParams(window.location.search);
          shop = urlParams.get('shop');
        }
        
        const response = await fetch(`/api/public/customizations?shop=${shop}`);
        const customizations = await response.json();
        
        // Apply customizations
        if (customizations.primary_color) {
          document.documentElement.style.setProperty('--primary-color', customizations.primary_color);
        }
        if (customizations.secondary_color) {
          document.documentElement.style.setProperty('--secondary-color', customizations.secondary_color);
        }
        if (customizations.text_color) {
          document.documentElement.style.setProperty('--text-color', customizations.text_color);
        }
        if (customizations.accent_color) {
          document.documentElement.style.setProperty('--accent-color', customizations.accent_color);
        }
        
        // Apply fonts
        if (customizations.heading_font || customizations.body_font) {
          const fonts = new Set([customizations.heading_font, customizations.body_font].filter(Boolean));
          const fontLink = document.createElement('link');
          fontLink.href = `https://fonts.googleapis.com/css2?family=${Array.from(fonts).join('&family=')}&display=swap`;
          fontLink.rel = 'stylesheet';
          document.head.appendChild(fontLink);
          
          if (customizations.heading_font) {
            document.documentElement.style.setProperty('--heading-font', customizations.heading_font);
          }
          if (customizations.body_font) {
            document.documentElement.style.setProperty('--body-font', customizations.body_font);
          }
        }
        
        // Apply hero image
        if (customizations.hero_image_url) {
          const hero = document.querySelector('.header');
          if (hero) {
            hero.style.backgroundImage = `url('${customizations.hero_image_url}')`;
            hero.style.backgroundSize = 'cover';
            hero.style.backgroundPosition = 'center';
          }
        }
        
        // Apply logo
        if (customizations.logo_url) {
          const header = document.querySelector('.header');
          if (header) {
            const logo = document.createElement('div');
            logo.className = 'logo';
            
            // Set logo size and positioning based on customization
            let maxWidth, maxHeight, topPosition, headerPadding;
            switch (customizations.logo_size) {
              case 'small':
                maxWidth = '120px';
                maxHeight = '40px';
                topPosition = '20px';
                headerPadding = '60px 20px';
                break;
              case 'large':
                maxWidth = '300px';
                maxHeight = '90px';
                topPosition = '30px';
                headerPadding = '120px 20px';
                break;
              default: // medium
                maxWidth = '200px';
                maxHeight = '60px';
                topPosition = '25px';
                headerPadding = '80px 20px';
                break;
            }
            
            logo.style.cssText = `position: absolute; top: ${topPosition}; left: 50%; transform: translateX(-50%); z-index: 10;`;
            logo.innerHTML = `<img src="${customizations.logo_url}" alt="Logo" style="max-height: ${maxHeight}; max-width: ${maxWidth};">`;
            
            // Adjust header padding to accommodate logo
            header.style.padding = headerPadding;
            
            header.appendChild(logo);
          }
        }
        
        // Handle example videos
        const examplesSection = document.getElementById('examplesSection');
        const videoRow = document.getElementById('videoRow');
        
        if (customizations.show_example_videos !== false && examplesSection && videoRow) {
          // Collect all valid video URLs
          const videoUrls = [
            customizations.example_video_1,
            customizations.example_video_2,
            customizations.example_video_3,
            customizations.example_video_4
          ].filter(url => url && url.trim());
          
          if (videoUrls.length > 0) {
            // Show the section
            examplesSection.style.display = 'block';
            
            // Clear existing videos
            videoRow.innerHTML = '';
            
            // Add CSS class based on number of videos
            videoRow.className = `video-row ${videoUrls.length === 1 ? 'single' : videoUrls.length === 2 ? 'two' : videoUrls.length === 3 ? 'three' : 'four'}`;
            
            // Create video containers
            videoUrls.forEach(videoUrl => {
              const videoContainer = document.createElement('div');
              videoContainer.className = 'video-container';
              videoContainer.onclick = function() { playVideo(this); };
              
              videoContainer.innerHTML = `
                <video class="video-placeholder" preload="metadata">
                  <source src="${videoUrl}" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
                <div class="play-button"></div>
              `;
              
              videoRow.appendChild(videoContainer);
            });
          } else {
            // Hide section if no videos
            examplesSection.style.display = 'none';
          }
        } else {
          // Hide section if disabled
          examplesSection.style.display = 'none';
        }
        
        // Apply custom CSS
        if (customizations.custom_css) {
          const style = document.createElement('style');
          style.textContent = customizations.custom_css;
          document.head.appendChild(style);
        }
        
        // Apply custom headings
        if (customizations.jobs_heading) {
          const headingEl = document.getElementById('pageHeading');
          if (headingEl) {
            headingEl.textContent = customizations.jobs_heading;
          }
        }
        if (customizations.jobs_subheading) {
          const subheadingEl = document.getElementById('pageSubheading');
          if (subheadingEl) {
            subheadingEl.textContent = customizations.jobs_subheading;
          }
        }
        
        // Show the page after customizations are applied
        document.body.classList.add('loaded');
      } catch (error) {
        console.error('Error loading customizations:', error);
        // Show page even if customizations fail
        document.body.classList.add('loaded');
      }
    }
    
    // Load customizations immediately
    loadCustomizations();

    let allJobs = [];
    let currentFilter = 'all';
    let selectedJob = null;
    let currentDeadlineFilter = 'all';
    let currentRewardFilter = 'all';

    // Load jobs on page load (replace the existing loadJobs function in jobs.html)
    async function loadJobs() {
      try {
        // Get shop from URL path or fallback to query params for backward compatibility
        let shop = null;
        
        // First try to get shop from URL path
        const pathParts = window.location.pathname.split('/');
        if (pathParts.length > 2 && pathParts[1] === 'jobs' && pathParts[2] && pathParts[2].trim() !== '') {
          shop = decodeURIComponent(pathParts[2]);
        } else {
          // Fallback to query params for backward compatibility
          const urlParams = new URLSearchParams(window.location.search);
          shop = urlParams.get('shop');
        }
        
        // First, check if the store has email configured
        const customizationsResponse = await fetch(`/api/public/customizations?shop=${encodeURIComponent(shop)}`);
        const customizations = await customizationsResponse.json();
        
        // Check if email is configured
        const emailConfigured = customizations.email_from_name && 
                              customizations.notification_email && 
                              customizations.email_from_name.trim() !== '' && 
                              customizations.notification_email.trim() !== '';
        
        // Load jobs
        const response = await fetch(`/api/public/jobs?shop=${encodeURIComponent(shop)}`);
        const data = await response.json();
        allJobs = data.jobs || [];
        
        // Store email configuration status globally
        window.emailConfigured = emailConfigured;
        
        // Display warning banner if email not configured
        if (!emailConfigured) {
          showEmailNotConfiguredWarning();
        }
        
        displayJobs();
      } catch (error) {
        console.error('Error loading jobs:', error);
        document.getElementById('jobsGrid').innerHTML = `
          <div class="empty-state">
            <h3>Oops! Having trouble loading opportunities</h3>
            <p>Please refresh the page to try again 💫</p>
          </div>
        `;
      }
    }

    // Show email configuration warning
    function showEmailNotConfiguredWarning() {
      // Check if warning already exists
      if (document.getElementById('emailWarningBanner')) {
        return;
      }
      
      const warningBanner = document.createElement('div');
      warningBanner.id = 'emailWarningBanner';
      warningBanner.innerHTML = `
        <div style="background-color: #fff3cd; border: 2px solid #ffeaa7; border-radius: 16px; padding: 25px; margin: 0 auto 40px auto; max-width: 1200px;">
          <div style="display: flex; align-items: start; gap: 15px;">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#856404" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <div style="flex: 1;">
              <h3 style="margin: 0 0 10px 0; color: #856404; font-size: 20px; font-weight: 600;">
                Submissions Temporarily Unavailable
              </h3>
              <p style="margin: 0 0 10px 0; color: #856404; font-size: 16px; line-height: 1.6;">
                This store is still setting up their UGC submission system. You can browse available jobs, but submissions cannot be accepted until setup is complete.
              </p>
              <p style="margin: 0; color: #856404; font-size: 14px; font-style: italic;">
                Please check back later or contact the store directly for more information.
              </p>
            </div>
          </div>
        </div>
      `;
      
      // Insert after header
      const container = document.querySelector('.container');
      if (container) {
        container.insertBefore(warningBanner, container.firstChild);
      }
    }

    // Update the displayJobs function to show disabled state
    function displayJobs() {
      let filteredJobs = allJobs;
      
      // Filter by content type
      if (currentFilter !== 'all') {
        filteredJobs = filteredJobs.filter(job => job.type === currentFilter);
      }
      
      // Filter by deadline
      if (currentDeadlineFilter !== 'all') {
        const daysLimit = parseInt(currentDeadlineFilter);
        const now = new Date();
        filteredJobs = filteredJobs.filter(job => {
          if (!job.deadline) return false;
          const deadline = new Date(job.deadline);
          const daysLeft = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
          return daysLeft <= daysLimit && daysLeft >= 0;
        });
      }
      
      // Filter by reward type
      if (currentRewardFilter !== 'all') {
        filteredJobs = filteredJobs.filter(job => job.reward_type === currentRewardFilter);
      }

      const jobsGrid = document.getElementById('jobsGrid');

      if (filteredJobs.length === 0) {
        jobsGrid.innerHTML = `
          <div class="empty-state">
            <h3>No opportunities right now</h3>
            <p>Check back soon - new jobs are added frequently! 🌟</p>
          </div>
        `;
        return;
      }

      jobsGrid.innerHTML = filteredJobs.map(job => {
        const spotsLeft = job.spots_available - job.spots_filled;
        const isLowSpots = spotsLeft <= 2;
        const isDisabled = !window.emailConfigured;
        
        return `
          <div class="job-card ${isDisabled ? 'disabled' : ''}" onclick="${isDisabled ? 'showSubmissionDisabledMessage(event)' : `openJobModal(${job.id})`}">
            <span class="job-type ${job.type}">${job.type === 'video' ? '🎬 Video' : '📸 Photo'}</span>
            <h3 class="job-title">${job.title}</h3>
            <p class="job-description">${job.description.substring(0, 120)}${job.description.length > 120 ? '...' : ''}</p>
            <div class="job-meta">
              <span class="reward"><span class="reward-label">Reward:</span> <span class="reward-value">${formatReward(job)}</span></span>
              <span class="spots-left ${isLowSpots ? 'low' : ''}">${spotsLeft} ${spotsLeft === 1 ? 'spot' : 'spots'} left</span>
            </div>
            ${job.deadline ? `<p class="deadline">⏰ Deadline: ${new Date(job.deadline).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</p>` : ''}
            ${isDisabled ? '<div style="text-align: center; margin-top: 15px; color: #856404; font-weight: 600; font-size: 14px;">⚠️ Setup Required</div>' : ''}
          </div>
        `;
      }).join('');
    }

    // Show message when clicking on disabled job
    function showSubmissionDisabledMessage(event) {
      event.preventDefault();
      event.stopPropagation();
      alert('Submissions are temporarily unavailable while the store completes their setup. Please try again later or contact the store directly.');
    }

    // Filter jobs by content type
    function filterJobs(type) {
      currentFilter = type;
      
      // Update active button
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      displayJobs();
    }
    
    // Apply all filters
    function applyFilters() {
      currentDeadlineFilter = document.getElementById('deadlineFilter').value;
      currentRewardFilter = document.getElementById('rewardFilter').value;
      displayJobs();
    }

    // Format reward display
    function formatReward(job) {
      if (job.reward_type === 'percentage') {
        return job.reward_value + '% off';
      } else if (job.reward_type === 'fixed') {
        return '$' + job.reward_value + ' off';
      } else if (job.reward_type === 'giftcard') {
        return '$' + (job.reward_giftcard_amount || '') + ' gift card';
      } else {
        return 'Free ' + (job.reward_product || 'product');
      }
    }
    
    // Check if content is a video URL
    function isVideoUrl(content) {
      const videoExtensions = ['.mp4', '.mov', '.avi', '.wmv', '.flv', '.webm', '.mkv'];
      const lowerContent = content.toLowerCase();
      
      // Check for video file extensions
      if (videoExtensions.some(ext => lowerContent.includes(ext))) {
        return true;
      }
      
      // Check for common video hosting URLs
      if (lowerContent.includes('youtube.com') || 
          lowerContent.includes('youtu.be') ||
          lowerContent.includes('vimeo.com') ||
          lowerContent.includes('dailymotion.com') ||
          lowerContent.includes('s3.amazonaws.com') ||
          lowerContent.includes('cloudfront.net')) {
        return true;
      }
      
      return false;
    }

    // Open job modal
    async function openJobModal(jobId) {
      try {
        // Get shop from URL path or fallback to query params for backward compatibility
        let shop = null; // no default fallback
        
        // First try to get shop from URL path
        const pathParts = window.location.pathname.split('/');
        if (pathParts.length > 2 && pathParts[1] === 'jobs' && pathParts[2] && pathParts[2].trim() !== '') {
          shop = decodeURIComponent(pathParts[2]);
        } else {
          // Fallback to query params for backward compatibility
          const urlParams = new URLSearchParams(window.location.search);
          shop = urlParams.get('shop');
        }
        
        const response = await fetch(`/api/public/jobs/${jobId}?shop=${encodeURIComponent(shop)}`);
        const data = await response.json();
        selectedJob = data.job;

        // Populate modal
        document.getElementById('modalJobType').textContent = selectedJob.type === 'video' ? '🎬 Video' : '📸 Photo';
        document.getElementById('modalJobType').className = `job-type ${selectedJob.type}`;
        document.getElementById('modalJobTitle').textContent = selectedJob.title;
        
        // Limit description to 50 words
        const words = selectedJob.description.split(' ');
        const limitedDescription = words.length > 50 
          ? words.slice(0, 50).join(' ') + '...'
          : selectedJob.description;
        document.getElementById('modalJobDescription').textContent = limitedDescription;
        
        // Requirements - show only first 3 bullets
        if (selectedJob.requirements) {
          const reqList = selectedJob.requirements.split('\n').filter(r => r.trim());
          const limitedReqList = reqList.slice(0, 3);
          const hasMoreRequirements = reqList.length > 3;
          
          document.getElementById('modalRequirements').innerHTML = `
            <h4>✨ What we're looking for:</h4>
            <ul>
              ${limitedReqList.map(req => `<li>${req}</li>`).join('')}
              ${hasMoreRequirements ? '<li>...</li>' : ''}
            </ul>
          `;
        } else {
          document.getElementById('modalRequirements').innerHTML = '';
        }

        // Meta info
        document.getElementById('modalReward').textContent = formatReward(selectedJob);
        const spotsLeft = selectedJob.spots_available - selectedJob.spots_filled;
        document.getElementById('modalSpots').innerHTML = `${spotsLeft} of ${selectedJob.spots_available} ${spotsLeft <= 2 ? '<span class="tag">Filling Fast!</span>' : ''}`;
        
        if (selectedJob.deadline) {
          const deadline = new Date(selectedJob.deadline);
          const daysLeft = Math.ceil((deadline - new Date()) / (1000 * 60 * 60 * 24));
          document.getElementById('modalDeadline').innerHTML = `⏰ Deadline: ${deadline.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })} <span style="color: #c06866; font-weight: normal;">(${daysLeft} days left)</span>`;
        } else {
          document.getElementById('modalDeadline').textContent = '';
        }

        // Example content - removed to keep modal clean
        document.getElementById('modalExample').innerHTML = '';

        // Show modal
        document.getElementById('jobModal').style.display = 'block';
        document.body.style.overflow = 'hidden';
      } catch (error) {
        console.error('Error loading job details:', error);
        alert('Oops! Could not load job details. Please try again.');
      }
    }

    // Close modal
    function closeModal() {
      document.getElementById('jobModal').style.display = 'none';
      document.body.style.overflow = 'auto';
      selectedJob = null;
    }

    // Submit for job
    function submitForJob() {
      if (selectedJob) {
        // Get shop from URL path or fallback to query params for backward compatibility
        let shop = null;
        
        // First try to get shop from URL path
        const pathParts = window.location.pathname.split('/');
        if (pathParts.length > 2 && pathParts[1] === 'jobs' && pathParts[2] && pathParts[2].trim() !== '') {
          shop = decodeURIComponent(pathParts[2]);
        } else {
          // Fallback to query params for backward compatibility
          const urlParams = new URLSearchParams(window.location.search);
          shop = urlParams.get('shop');
        }
        
        const submitUrl = shop ? `/submit?jobId=${selectedJob.id}&shop=${encodeURIComponent(shop)}` : `/submit?jobId=${selectedJob.id}`;
        window.location.href = submitUrl;
      }
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      if (event.target.classList.contains('modal')) {
        closeModal();
      }
    }

    // Play video function
    function playVideo(container) {
      const video = container.querySelector('video');
      const playButton = container.querySelector('.play-button');
      
      if (video.paused) {
        video.play();
        container.classList.add('playing');
        video.controls = true;
      } else {
        video.pause();
        container.classList.remove('playing');
        video.controls = false;
      }
    }
    
    // Add event listeners for video ended
    document.addEventListener('DOMContentLoaded', function() {
      const videos = document.querySelectorAll('.video-placeholder');
      videos.forEach(video => {
        video.addEventListener('ended', function() {
          const container = this.closest('.video-container');
          container.classList.remove('playing');
          this.controls = false;
        });
      });
    });

    // Load jobs on page load
    loadJobs();
  </script>
</body>
</html>